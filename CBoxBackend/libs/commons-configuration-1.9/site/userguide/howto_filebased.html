<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Aug 4, 2012 ( $Revision: 1080083 $ ) -->
<!-- $HeadURL: https://svn.apache.org/repos/asf/commons/proper/commons-skin/trunk/src/main/resources/META-INF/maven/site.vm $ -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>
  File-based Configurations</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
      <meta name="author" content="Oliver Heger" />
    <meta name="Date-Revision-yyyymmdd" content="20120804" />
    <meta http-equiv="Content-Language" content="en" />
                                                    
<link rel="stylesheet" type="text/css" media="all" href="../css/prettify.css"/>                                                        
<script src="../js/prettify.js" type="text/javascript"></script>                                                        
<script type="text/javascript">window.onload=function() {
            prettyPrint();
        }</script>                      
        </head>
  <body class="composite">
    <div id="banner">
            <div id="bannerLeft">
                                            <a href="http://commons.apache.org/" title="Apache Commons logo">
                                        <img src="../images/commons-logo.png" alt="Apache Commons logo"/>
                </a>
            </div><!-- id="bannerLeft" -->
              <div id="bannerRight">
                                                          <a href="../index.html">
                                                <img src="../images/logo.png" alt="Commons Configuration"/>
                </a>
            </div><!-- id="bannerRight" -->
        <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                
                <div class="xleft">
        <span id="publishDate">Last Published: 04 August 2012</span>
                  &nbsp;| <span id="projectVersion">Version: 1.9</span>
                      </div>
            <div class="xright">                    <a href="http://www.apachecon.com/" class="externalLink" title="ApacheCon">ApacheCon</a>
            |
                        <a href="http://www.apache.org" class="externalLink" title="Apache">Apache</a>
            |
                        <a href="../../" title="Commons">Commons</a>
              
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                
                                <h5>Configuration</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="../download_configuration.cgi" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../changes-report.html" title="Release History">Release History</a>
            </li>
                  <li class="none">
                          <a href="../userguide/user_guide.html" title="User's Guide">User's Guide</a>
            </li>
                  <li class="none">
                          <a href="../dependencies.html" title="Runtime Dependencies">Runtime Dependencies</a>
            </li>
                  <li class="none">
                          <a href="../apidocs/index.html" title="Javadoc">Javadoc</a>
            </li>
          </ul>
                       <h5>Development</h5>
                  <ul>
                  <li class="none">
                          <a href="../building.html" title="Building">Building</a>
            </li>
                  <li class="none">
                          <a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                       <h5>Commons</h5>
                  <ul>
                  <li class="none">
                          <a href="../../" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/licenses/" class="externalLink" title="License">License</a>
            </li>
                                                                    <li class="collapsed">
                          <a href="../../components.html" title="Components">Components</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../../sandbox/index.html" title="Sandbox">Sandbox</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../../dormant/index.html" title="Dormant">Dormant</a>
                  </li>
          </ul>
                       <h5>General Information</h5>
                  <ul>
                  <li class="none">
                          <a href="../../volunteering.html" title="Volunteering">Volunteering</a>
            </li>
                  <li class="none">
                          <a href="../../patches.html" title="Contributing Patches">Contributing Patches</a>
            </li>
                  <li class="none">
                          <a href="../../building.html" title="Building Components">Building Components</a>
            </li>
                  <li class="none">
                          <a href="../../releases/index.html" title="Releasing Components">Releasing Components</a>
            </li>
                  <li class="none">
                          <a href="http://wiki.apache.org/commons/FrontPage" class="externalLink" title="Wiki">Wiki</a>
            </li>
          </ul>
                       <h5>ASF</h5>
                  <ul>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works">How the ASF works</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/getinvolved.html" class="externalLink" title="Get Involved">Get Involved</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/dev/" class="externalLink" title="Developer Resources">Developer Resources</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a>
            </li>
          </ul>
                                                                                                                   <a href="http://www.apache.org/events/current-event.html" title="ApacheCon" class="poweredBy">
        <img class="poweredBy"  alt="ApacheCon" src="http://www.apache.org/events/current-event-125x125.png"    />
      </a>
                                                                                                    <a href="http://maven.apache.org/" title="Maven" class="poweredBy">
        <img class="poweredBy"  alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    />
      </a>
                       
                
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!-- Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License. -->

 
    <div class="section"><h2>File-based Configurations<a name="File-based_Configurations"></a></h2>
        <p>
            Often configuration properties are stored in files on the user's hard
          disk, e.g. in .properties files or as XML documents. Configuration
          classes that deal with such properties need to provide typical operations
          like loading or saving files. The files to be processed can be specified
          in several different flavors like <tt>java.io.File</tt> objects,
          relative or absolute path names, or URLs.
        </p>
        <p>
          To provide a consistent way of dealing with configuration files in
          Commons Configuration the <tt><a href="../apidocs/org/apache/commons/configuration/FileConfiguration.html">FileConfiguration</a></tt>
          interface exists. <tt>FileConfiguration</tt> defines a standard
          API for accessing files and is implemented by many configuration
          implementations, including <tt>PropertiesConfiguration</tt> and
          <tt>XMLConfiguration</tt>.
        </p>
        <p>
          In the following sections we take a closer look at the methods of the
          <tt>FileConfiguration</tt> interface and how they are used.
        </p>

        <div class="section"><h3>Specifying the file<a name="Specifying_the_file"></a></h3>
          <p>
            The <tt>FileConfiguration</tt> interface contains several
            methods for specifying the file to be loaded. The following variants
            are supported:
            </p><ul>
              <li>With the <tt>setFile()</tt> method the data file can be
              specified as a <tt>java.io.File</tt> object.</li>
              <li>The <tt>setURL()</tt> takes a <tt>java.net.URL</tt>
              as argument; the file will be loaded from this URL.</li>
              <li>The methods <tt>setFileName()</tt> and <tt>setBasePath()</tt>
              allows to specify the path of the data file. The base path is
              important if relative paths are to be resolved based on this file.</li>
            </ul>
          
          <p>
            While a <tt>File</tt> or a URL uniquely identify a file, the
            situation is a bit ambigous when only a base path and a file name are
            set. These can be arbitrary strings (even full URLs) whose exact
            meaning must be detected when the file is loaded. For this purpose
            file-based configurations perform the following checks (in this
            order):
            </p><ul>
              <li>If the combination from base path and file name is a full URL
              that points to an existing file, this URL will be used to load
              the file.</li>
              <li>If the combination from base path and file name is an absolute
              file name and this file exists, it will be loaded.</li>
              <li>If the combination from base path and file name is a relative
              file path that points to an existing file, this file will be loaded.</li>
              <li>If a file with the specified name exists in the user's home
              directory, this file will be loaded.</li>
              <li>Otherwise the file name is interpreted as a resource name, and
              it is checked whether the data file can be loaded from the classpath.</li>
            </ul>
            If all these checks fail, a <tt>ConfigurationException</tt> will
            be thrown.
          
        </div>

        <div class="section"><h3>Loading<a name="Loading"></a></h3>
          <p>
            After the file name has been defined using one of the methods mentioned
            above, the <tt>load()</tt> method can be called. This method tries
            to locate the file and open it. If this fails, a <tt>ConfigurationException</tt>
            is thrown.
          </p>
          <p>
            The <tt>FileConfiguration</tt> interface defines multiple overloaded
            <tt>load()</tt> methods. The one that takes no argument will
            always operate on the file name that has been set earlier. All
            other methods allow to specify the source to be loaded. This can be
            done as <tt>java.io.File</tt>, <tt>java.net.URL</tt>, string
            (containing either an absolute or relative path), input stream, or
            reader. When using these variants of the <tt>load()</tt> method
            be aware of two things:
            </p><ol style="list-style-type: decimal">
              <li>They do not change the configuration's file name. To do this
              you have to explicitely call one of the setter methods.</li>
              <li>The <tt>load()</tt> methods do not empty the
              configuration before new data is loaded. This makes it easy to
              construct union configurations by simply calling <tt>load()</tt>
              multiple times. But if you want to reuse a <tt>Configuration</tt>
              object and load a different file, remember to call the
              <tt>clear()</tt> method first to ensure that old properties are
              wiped out.</li>
            </ol>
          
          <p>
            File-based configurations typically define a set of constructors that
            correspond to the various setter methods for defining the data file.
            These constructors will set the file and then invoke the <tt>load()</tt>
            method. So creating a file-based configuration object and loading its
            content can be done in a single step.
          </p>
        </div>

        <div class="section"><h3>Saving<a name="Saving"></a></h3>
          <p>
            Saving is implemented analogously to loading: There is a no argument
            <tt>save()</tt> method that will use the internal file name. Then
            for each <tt>load()</tt> method a corresponding <tt>save()</tt>
            method exists that will write the data contained in the configuration
            to different targets.
          </p>
          <p>
            An example for loading, manipulating, and saving a configuration
            (based on a <a href="howto_properties.html"><tt>PropertiesConfiguration</tt></a>)
            could look as follows:
          </p>
<div class="source"><pre>
PropertiesConfiguration config = new PropertiesConfiguration(&quot;usergui.properties&quot;);
config.setProperty(&quot;colors.background&quot;, &quot;#000000&quot;);
config.save();
</pre></div>
          <p>
            You can also save a copy of the configuration to another file:
          </p>
<div class="source"><pre>
PropertiesConfiguration config = new PropertiesConfiguration(&quot;usergui.properties&quot;);
config.setProperty(&quot;colors.background&quot;, &quot;#000000&quot;);
config.save(&quot;usergui.backup.properties);
</pre></div>
        </div>

        <div class="section"><h3>Automatic Saving<a name="Automatic_Saving"></a></h3>
          <p>
            If you want to ensure that every modification of a configuration
            object is immideately written to disk, you can enable the automatic
            saving mode. This is done through the <tt>setAutoSave()</tt>
            method as shown in the following example:
          </p>
<div class="source"><pre>
PropertiesConfiguration config = new PropertiesConfiguration(&quot;usergui.properties&quot;);
config.setAutoSave(true);
config.setProperty(&quot;colors.background&quot;, &quot;#000000&quot;); // the configuration is saved after this call
</pre></div>
          <p>
            Be careful with this mode when you have many updates on your
            configuration. This will lead to many I/O operations, too.
          </p>
        </div>

        <div class="section"><h3>Automatic Reloading<a name="Automatic_Reloading"></a></h3>
        <p>
          A common issue with file-based configurations is to handle the
          reloading of the data file when it changes. This is especially important
          if you have long running applications and do not want to restart them
          when a configuration file was updated. Commons Configuration has the
          concept of so called <i>reloading strategies</i> that can be
          associated with a file-based configuration. Such a strategy monitors
          a configuration file and is able to detect changes. A default reloading
          strategy is <tt><a href="../apidocs/org/apache/commons/configuration/reloading/FileChangedReloadingStrategy.html">FileChangedReloadingStrategy</a></tt>.
          It can be set on a file-based configuration as follows:
        </p>
<div class="source"><pre>
PropertiesConfiguration config = new PropertiesConfiguration(&quot;usergui.properties&quot;);
config.setReloadingStrategy(new FileChangedReloadingStrategy());
</pre></div>
        <p>
          <tt>FileChangedReloadingStrategy</tt> works as follows: On every
          property access the configuration checks its associated reloading
          strategy. <tt>FileChangedReloadingStrategy</tt> will then obtain
          the last modification date of the configuration file and check whether
          it has changed since the last access. If this is the case, a reload is
          triggered. To avoid often disk access when multiple properties are
          queried from the configuration, a <i>refresh delay</i> can be set on
          the reloading strategy. This is a time in milli seconds with the meaning
          that the reloading strategy will only once check the file's last
          modification time in the period specified here.
        </p>
        </div>

        <div class="section"><h3>Managed Reloading<a name="Managed_Reloading"></a></h3>
        <p>
          <tt>ManagedReloadingStrategy</tt> is an alternative to automatic
          reloading. It allows to hot-reload properties on a running application
          but only when requested by admin. The <tt>refresh()</tt> method
          will force a reload of the configuration source.
        </p>
        <p>
          A typical use of this feature is to setup ManagedReloadingStrategy as
          a JMX MBean. The following code sample uses Springframework
          MBeanExporter to expose the ManagedReloadingStrategy to the JMX
          console :
</p><div class="source"><pre>

&lt;!-- A file based configuration bean --&gt;
&lt;bean id=&quot;configuration&quot; class=&quot;(...).PropertiesConfiguration&quot;&gt;
    &lt;constructor-arg type=&quot;java.net.URL&quot; value=&quot;file:${user.home}/custom.properties&quot;/&gt;
    &lt;property name=&quot;reloadingStrategy&quot; ref=&quot;reloadingStrategy&quot;/&gt;
&lt;/bean&gt;

&lt;!-- The managed reloading strategy for the configuration bean --&gt;
&lt;bean id=&quot;reloadingStrategy&quot; class=&quot;...ManagedReloadingStrategy&quot;/&gt;

&lt;!-- The MBeanExporter that exposes reloadingStrategy to the JMX console --&gt;
&lt;bean id=&quot;mbeanMetadataExporter&quot; class=&quot;org.springframework.jmx.export.MBeanExporter&quot;&gt;
    &lt;property name=&quot;server&quot; ref=&quot;mbeanServer&quot;/&gt;
    &lt;property name=&quot;beans&quot;&gt;
        &lt;map&gt;
            &lt;entry key=&quot;myApp:bean=configuration&quot; value-ref=&quot;reloadingStrategy&quot;/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;

</pre></div>
          With this configuration, the JMX console will expose the
          &quot;myApp:bean=configuration&quot; MBean and it's refresh operation.
        
        </div>
    </div>




      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="center">Copyright &#169;                    2001-2012
                        <a href="http://www.apache.org/">The Apache Software Foundation</a>.
            All Rights Reserved.      
                
      </div>
                          
<div class="center">Apache Commons, Apache Commons Configuration, Apache, the Apache feather logo, and the Apache Commons project logos are trademarks of The Apache Software Foundation.
      All other marks mentioned may be trademarks or registered trademarks of their respective owners.</div>
                <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
